{"version":3,"file":"index.js","sources":["../src/operators/par.js","../src/is.js","../src/operators/handle.js","../src/operators/assign.js","../src/operators/prev.js","../src/reactive.jsx"],"sourcesContent":["import { merge } from 'rxjs';\n\nexport function par(...operators) {\n  return props$ => merge(...operators.map(op => op(props$)));\n}\n","// @flow\nexport function isFunction(o: any): boolean {\n  return typeof o === 'function';\n}\n\nexport function isObject(o: any): boolean {\n  return (\n    Boolean(o)\n        && typeof o === 'object'\n        && Object.prototype.toString.call(o) === '[object Object]'\n  );\n}\n\nexport function isNil(o: any): boolean {\n  return o === null || o === undefined;\n}\n\nexport function isSame(objA: any, objB: any): boolean {\n  if (objA === objB) {\n    return true;\n  }\n  if (!isObject(objA) || !isObject(objB)) {\n    return false;\n  }\n  const keysA = Object.keys(objA);\n  const keysB = Object.keys(objB);\n  const sameSize = keysA.length === keysB.length;\n  const sameValues = () => keysA.every(key => objA[key] === objB[key]);\n  return sameSize && sameValues();\n}\n","// @flow\n/* eslint-disable no-redeclare, no-unused-vars */\nimport {\n  Subject, of, concat, Observable,\n} from 'rxjs';\nimport {\n  filter, pluck, distinctUntilChanged, switchMap,\n} from 'rxjs/operators';\nimport { isFunction, isObject } from '../is';\n\ntype ResultOperator<Props> = (\n    Observable<Props>,\n) => Observable<Props | { [propName: string]: (event: any) => void }>;\ndeclare function handle<Props, I>(\n    propName: string,\n    rxjs$OperatorFunction<I, Props>,\n): ResultOperator<Props>;\ndeclare function handle<Props, I, O1>(\n    propName: string,\n    rxjs$OperatorFunction<I, O1>,\n    rxjs$OperatorFunction<O1, $Shape<Props>>,\n): ResultOperator<Props>;\ndeclare function handle<Props, I, O1, O2>(\n    propName: string,\n    rxjs$OperatorFunction<I, O1>,\n    rxjs$OperatorFunction<O1, O2>,\n    rxjs$OperatorFunction<O2, $Shape<Props>>,\n): ResultOperator<Props>;\ndeclare function handle<Props, I, O1, O2, O3>(\n    propName: string,\n    rxjs$OperatorFunction<I, O1>,\n    rxjs$OperatorFunction<O1, O2>,\n    rxjs$OperatorFunction<O2, O3>,\n    rxjs$OperatorFunction<O3, $Shape<Props>>,\n): ResultOperator<Props>;\ndeclare function handle<Props, I, O1, O2, O3, O4>(\n    propName: string,\n    rxjs$OperatorFunction<I, O1>,\n    rxjs$OperatorFunction<O1, O2>,\n    rxjs$OperatorFunction<O2, O3>,\n    rxjs$OperatorFunction<O3, O4>,\n    rxjs$OperatorFunction<O4, $Shape<Props>>,\n): ResultOperator<Props>;\ndeclare function handle<Props, I, O1, O2, O3, O4, O5>(\n    propName: string,\n    rxjs$OperatorFunction<I, O1>,\n    rxjs$OperatorFunction<O1, O2>,\n    rxjs$OperatorFunction<O2, O3>,\n    rxjs$OperatorFunction<O3, O4>,\n    rxjs$OperatorFunction<O4, O5>,\n    rxjs$OperatorFunction<O5, $Shape<Props>>,\n): ResultOperator<Props>;\ndeclare function handle<Props, I, O1, O2, O3, O4, O5, O6>(\n    propName: string,\n    rxjs$OperatorFunction<I, O1>,\n    rxjs$OperatorFunction<O1, O2>,\n    rxjs$OperatorFunction<O2, O3>,\n    rxjs$OperatorFunction<O3, O4>,\n    rxjs$OperatorFunction<O4, O5>,\n    rxjs$OperatorFunction<O5, O6>,\n    rxjs$OperatorFunction<O6, $Shape<Props>>,\n): ResultOperator<Props>;\ndeclare function handle<Props, I, O1, O2, O3, O4, O5, O6, O7>(\n    propName: string,\n    rxjs$OperatorFunction<I, O1>,\n    rxjs$OperatorFunction<O1, O2>,\n    rxjs$OperatorFunction<O2, O3>,\n    rxjs$OperatorFunction<O3, O4>,\n    rxjs$OperatorFunction<O4, O5>,\n    rxjs$OperatorFunction<O5, O6>,\n    rxjs$OperatorFunction<O6, O7>,\n    rxjs$OperatorFunction<O7, $Shape<Props>>,\n): ResultOperator<Props>;\ndeclare function handle<Props, I, O1, O2, O3, O4, O5, O6, O7, O8>(\n    propName: string,\n    rxjs$OperatorFunction<I, O1>,\n    rxjs$OperatorFunction<O1, O2>,\n    rxjs$OperatorFunction<O2, O3>,\n    rxjs$OperatorFunction<O3, O4>,\n    rxjs$OperatorFunction<O4, O5>,\n    rxjs$OperatorFunction<O5, O6>,\n    rxjs$OperatorFunction<O6, O7>,\n    rxjs$OperatorFunction<O7, O8>,\n    rxjs$OperatorFunction<O8, $Shape<Props>>,\n    ...operations: rxjs$OperatorFunction<any, any>[]\n): ResultOperator<Props>;\n\nexport function handle(propName, ...handlerOperators) {\n  return props$ => props$.pipe(\n    pluck(propName),\n    distinctUntilChanged(),\n    switchMap((handler) => {\n      const eventsSubject = new Subject();\n      const wrappedHandler = (event) => {\n        eventsSubject.next(event);\n        if (isFunction(handler)) handler(event);\n      };\n      return concat(\n        of({\n          [propName]: wrappedHandler,\n        }),\n        eventsSubject.pipe(\n          ...handlerOperators,\n          filter(obj => !(obj instanceof Event)),\n          filter(isObject),\n        ),\n      );\n    }),\n  );\n}\n","// @flow\nimport { scan } from 'rxjs/operators';\n\ntype ReturnType<T> = $Call<\n  typeof scan,\n  <T>(acc: T | {}, delta: T, index: number) => T | {}, T | {}\n>;\n\nexport function assign<T>(): ReturnType<T> {\n  return scan((acc, delta) => Object.assign({}, acc, delta), {});\n}\n","// @flow\nimport { startWith, pairwise, map } from 'rxjs/operators';\n\nexport function prev<T>(startVal?: T): rxjs$OperatorFunction<T, T> {\n  return props$ => props$.pipe(\n    startWith(startVal),\n    pairwise(),\n    map(([previous]) => previous),\n  );\n}\n","// @flow\nimport * as React from 'react';\nimport {\n  BehaviorSubject, of, concat, combineLatest, Subscription,\n} from 'rxjs';\nimport type { Observable } from 'rxjs';\nimport { filter, distinctUntilChanged } from 'rxjs/operators';\nimport { assign } from './operators';\nimport { isObject, isSame } from './is';\n\nexport function reactive<Config: {}>(\n  propsMapper: (arg: Observable<Config>) => Observable<$Shape<Config>>,\n): (React.AbstractComponent<Config>) => React.AbstractComponent<Config> {\n  return (WrappedComponent): React.AbstractComponent<Config> => (\n    class ReactiveWrapper extends React.Component<Config, Config> {\n      static displayName = `Reactive(${WrappedComponent.displayName || WrappedComponent.name || ''})`;\n\n      constructor(props: Config) {\n        super(props);\n        this.state = props;\n      }\n\n      componentDidMount() {\n        this.propsSubject = new BehaviorSubject(this.props);\n        const props$ = this.propsSubject.pipe(distinctUntilChanged(isSame));\n        const deltaProps$ = propsMapper(props$).pipe(\n          filter(isObject),\n          assign(),\n        );\n        const newProps$ = combineLatest(\n          props$,\n          concat(of({}), deltaProps$),\n          (props, delta) => Object.assign({}, props, delta),\n        );\n        this.subscription = newProps$.subscribe((newProps: Config) => {\n          this.setState(newProps);\n        });\n      }\n\n      componentDidUpdate() {\n        this.propsSubject.next(this.props);\n      }\n\n      componentWillUnmount() {\n        this.propsSubject.complete();\n        this.subscription.unsubscribe();\n      }\n\n      subscription: Subscription;\n\n      propsSubject: BehaviorSubject<Config>;\n\n      render() {\n        return <WrappedComponent {...this.state} />;\n      }\n    }\n  );\n}\n"],"names":["par","operators","props$","merge","map","op","isFunction","o","isObject","Boolean","Object","prototype","toString","call","isNil","undefined","isSame","objA","objB","keysA","keys","keysB","sameSize","length","sameValues","every","key","handle","propName","handlerOperators","pipe","pluck","distinctUntilChanged","switchMap","handler","eventsSubject","Subject","wrappedHandler","event","next","concat","of","filter","obj","Event","assign","scan","acc","delta","prev","startVal","startWith","pairwise","previous","reactive","propsMapper","WrappedComponent","props","state","componentDidMount","propsSubject","BehaviorSubject","deltaProps$","newProps$","combineLatest","subscription","subscribe","newProps","setState","componentDidUpdate","componentWillUnmount","complete","unsubscribe","render","React.createElement","React","displayName","name"],"mappings":"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"}